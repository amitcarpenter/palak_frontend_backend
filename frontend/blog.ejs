<%- include('blog_header.ejs') %>

  <style>
    .pagination li {
      margin-bottom: 3px;
      margin: auto;
      display: inline-block;
    }
  </style>

  <div class="site-mobile-menu site-navbar-target">
    <div class="site-mobile-menu-header">
      <div class="site-mobile-menu-close">
        <span class="icofont-close js-menu-toggle"></span>
      </div>
    </div>
    <div class="site-mobile-menu-body"></div>
  </div>
  <!-- Start retroy layout blog posts -->
  <section class="section bg-light mt-5">
    <div class="container">
      <div class="row align-items-stretch retro-layout">
        <div class="col-md-4">
          <a href="#" class="h-entry mb-30 v-height gradient">
            <div class="featured-img" style="background-image: url('img/blog/blog1image.avif')"></div>

            <div class="text">
              <span class="date">January. 14th, 2024</span>
              <h2>
                5 of the Most Expensive and Affordable Ontario Homes Sold in
                January
              </h2>
            </div>
          </a>
          <a href="#" class="h-entry v-height gradient">
            <div class="featured-img" style="background-image: url('img/blog/blog2image.avif')"></div>

            <div class="text">
              <span class="date">December. 12th, 2023</span>
              <h2>Love Your Home: 5 DIY Projects for a Cozier Space</h2>
            </div>
          </a>
        </div>
        <div class="col-md-4">
          <a href="#" class="h-entry img-5 h-100 gradient">
            <div class="featured-img" style="background-image: url('img/blog/blog3image.avif')"></div>

            <div class="text">
              <span class="date">December. 14th, 2023</span>
              <h2>
                Renewed Buyer Interest is Driving Sales Up in the Toronto
                Region Market: TRREB
              </h2>
            </div>
          </a>
        </div>
        <div class="col-md-4">
          <a href="#" class="h-entry mb-30 v-height gradient">
            <div class="featured-img" style="background-image: url('img/blog/blog4image.avif')"></div>

            <div class="text">
              <span class="date">January. 1th, 2023</span>
              <h2>
                The Most Affordable Places to Buy Real Estate in Ontario in
                2023
              </h2>
            </div>
          </a>
          <a href="#" class="h-entry v-height gradient">
            <div class="featured-img" style="background-image: url('img/blog/blog5image.jpg')"></div>

            <div class="text">
              <span class="date">January. 5th, 2024</span>
              <h2>
                To Rent or Buy: How Do Rental and Resale Monthly Costs Compare
                in 2024?
              </h2>
            </div>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- End retroy layout blog posts -->

  <section class="section">
    <div class="container">
      <div class="row mb-4">
        <div class="col-sm-6">
          <h2 class="posts-entry-title">Blogs</h2>
        </div>
        <div class="col-sm-6 text-sm-end">
          <!-- <a href="category.html" class="read-more">View All</a> -->
        </div>
      </div>

      <div class="row" id="blogsContainer"></div>
    </div>
  </section>
  <div id="paginationContainer"></div>

  <!-- Preloader -->
  <div id="overlayer"></div>
  <div class="loader">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <script src="js_blog/bootstrap.bundle.min.js"></script>
  <script src="js_blog/tiny-slider.js"></script>
  <script src="js_blog/flatpickr.min.js"></script>
  <script src="js_blog/aos.js"></script>
  <script src="js_blog/glightbox.min.js"></script>
  <script src="js_blog/navbar.js"></script>
  <script src="js_blog/counter.js"></script>
  <script src="js_blog/custom.js"></script>

  <script>
    async function fetchBlogData() {
      try {
        const response = await fetch("https://crm-farhan.artechworld.tech/blog/getdata");
        const data = await response.json();
        console.log(data.data);
        return data.data;
      } catch (error) {
        console.error("Error fetching blog data:", error);
      }
    }

    async function fetchAndRenderPosts(pageNumber, postsPerPage) {
      const blogData = await fetchBlogData();
      renderBlogPosts(blogData, pageNumber, postsPerPage);
    }

    function renderBlogPosts(posts, currentPage = 1, postsPerPage = 9) {
      const blogsContainer = document.getElementById("blogsContainer");
      const startIndex = (currentPage - 1) * postsPerPage;
      const endIndex = startIndex + postsPerPage;
      const paginatedPosts = posts.slice(startIndex, endIndex);

      function formatDate(timestamp) {
        const options = { year: "numeric", month: "long", day: "numeric" };
        const date = new Date(timestamp);
        return date.toLocaleDateString("en-US", options);
      }

      function truncateContent(content, wordLimit) {
        const words = content.split(" ");
        if (words.length > wordLimit) {
          return words.slice(0, wordLimit).join(" ") + "...";
        } else {
          return content;
        }
      }

      if (Array.isArray(paginatedPosts)) {
        blogsContainer.innerHTML = ""; // Clear existing content

        paginatedPosts.forEach((post) => {
          const baseUrl = "https://crm-farhan.artechworld.tech";
          const imageUrl = `${baseUrl}/${post.image}`;
          const formattedDate = formatDate(post.post_time);

          const truncatedContent = truncateContent(post.content, 50);

          const postHtml = `
						<div class="col-lg-4 mb-4">
							<div class="post-entry-alt">
								<a href="#" class="img-link" onclick="showSingleBlog('${post._id}')">
                            <img src="${imageUrl}" alt="Image" class="img-fluid" />
                        </a>
								<div class="excerpt">
									<h2><a onclick="showSingleBlog('${post._id}')">${post.title}</a></h2>
									<div class="post-meta align-items-center text-left clearfix">
										<figure class="author-figure mb-0 me-3 float-start">
											<img src="img/trainer/palak.jpg" alt="Image" class="img-fluid" />
										</figure>
										<span class="d-inline-block mt-1">By <a href="#">${post.author}</a></span>
										<span>&nbsp;-&nbsp; ${formattedDate}</span>
									</div>
									<p>${truncatedContent}</p>
									<p><a onclick="showSingleBlog('${post._id}')" class="read-more">Continue Reading</a></p>
								</div>
							</div>
						</div>
					`;

          blogsContainer.insertAdjacentHTML("beforeend", postHtml);
        });

        renderPagination(posts.length, currentPage, postsPerPage);
      } else {
        console.error("Invalid data format: posts is not an array");
      }
    }

    function renderPagination(totalPosts, currentPage, postsPerPage) {
      const totalPages = Math.ceil(totalPosts / postsPerPage);
      const paginationContainer = document.getElementById(
        "paginationContainer"
      );

      let paginationHtml = '<ul class="pagination">';
      for (let i = 1; i <= totalPages; i++) {
        const activeClass = i === currentPage ? "active" : "";
        paginationHtml += `<li class="page-item ${activeClass}"><a class="page-link" href="#" onclick="changePage(${i}, ${postsPerPage})">${i}</a></li>`;
      }
      paginationHtml += "</ul>";

      paginationContainer.innerHTML = paginationHtml;
    }

    function changePage(pageNumber, postsPerPage) {
      fetchAndRenderPosts(pageNumber, postsPerPage);
    }

    function showSingleBlog(postLink) {
      // Navigate to the single blog page with the selected postLink
      window.location.href = `single-blog?postLink=${postLink}`;
    }

    // Fetch blog data and render posts on page load
    document.addEventListener("DOMContentLoaded", async () => {
      const postsPerPage = 9;
      fetchAndRenderPosts(1, postsPerPage);
    });
  </script>
  <script src="js/jquery-3.3.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery.slicknav.js"></script>
  <script src="js/owl.carousel.min.js"></script>
  <script src="js/jquery.magnific-popup.min.js"></script>
  <script src="js/circle-progress.min.js"></script>
  <script src="js/jquery.barfiller.js"></script>
  <script src="js/main.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>

  </html>
  <%- include('footer.ejs') %>