<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="author" content="Untree.co" />
	<link rel="shortcut icon" href="favicon.png" />

	<meta name="description" content="" />
	<meta name="keywords" content="bootstrap, bootstrap5" />

	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;600;700&display=swap" rel="stylesheet" />

	<link rel="stylesheet" href="fonts/icomoon/style.css" />
	<link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" />

	<link rel="stylesheet" href="css/tiny-slider.css" />
	<link rel="stylesheet" href="css/aos.css" />
	<link rel="stylesheet" href="css/glightbox.min.css" />
	<link rel="stylesheet" href="css/style.css" />

	<link rel="stylesheet" href="css/flatpickr.min.css" />

	<title>Blog &mdash; Real Esate Blog Ontario</title>

	<style>
		body {
			background-color: #ffffff;
			font-family: "Montserrat", sans-serif;
		}
	</style>
</head>

<body>
	<div class="site-mobile-menu site-navbar-target">
		<div class="site-mobile-menu-header">
			<div class="site-mobile-menu-close">
				<span class="icofont-close js-menu-toggle"></span>
			</div>
		</div>
		<div class="site-mobile-menu-body"></div>
	</div>
	<!-- Start retroy layout blog posts -->
	<section class="section bg-light">
		<div class="container">
			<div class="row align-items-stretch retro-layout">
				<div class="col-md-4">
					<a href="#" class="h-entry mb-30 v-height gradient">
						<div class="featured-img" style="background-image: url('images/blog-image-1.webp')"></div>

						<div class="text">
							<span class="date">January. 14th, 2024</span>
							<h2>5 of the Most Expensive and Affordable Ontario Homes Sold in January</h2>
						</div>
					</a>
					<a href="#" class="h-entry v-height gradient">
						<div class="featured-img" style="background-image: url('images/blog-image-2.webp')"></div>

						<div class="text">
							<span class="date">December. 12th, 2023</span>
							<h2>Love Your Home: 5 DIY Projects for a Cozier Space</h2>
						</div>
					</a>
				</div>
				<div class="col-md-4">
					<a href="#" class="h-entry img-5 h-100 gradient">
						<div class="featured-img" style="background-image: url('images/img_1_vertical.jpg')"></div>

						<div class="text">
							<span class="date">December. 14th, 2023</span>
							<h2>Renewed Buyer Interest is Driving Sales Up in the Toronto Region Market: TRREB</h2>
						</div>
					</a>
				</div>
				<div class="col-md-4">
					<a href="#" class="h-entry mb-30 v-height gradient">
						<div class="featured-img" style="background-image: url('images/blog-image-3.webp')"></div>

						<div class="text">
							<span class="date">January. 1th, 2023</span>
							<h2>The Most Affordable Places to Buy Real Estate in Ontario in 2023</h2>
						</div>
					</a>
					<a href="#" class="h-entry v-height gradient">
						<div class="featured-img" style="background-image: url('images/blog-image-4.webp')"></div>

						<div class="text">
							<span class="date">January. 5th, 2024</span>
							<h2>To Rent or Buy: How Do Rental and Resale Monthly Costs Compare in 2024?</h2>
						</div>
					</a>
				</div>
			</div>
		</div>
	</section>

	<!-- End retroy layout blog posts -->
	<section class="section">
		<div class="container">
			<div class="row mb-4">
				<div class="col-sm-6">
					<h2 class="posts-entry-title">Blogs</h2>
				</div>
				<div class="col-sm-6 text-sm-end">
					<!-- <a href="category.html" class="read-more">View All</a> -->
				</div>
			</div>

			<div class="row" id="blogsContainer">

			</div>
		</div>
	</section>
	<div id="paginationContainer"></div>

	<!-- Preloader -->
	<div id="overlayer"></div>
	<div class="loader">
		<div class="spinner-border text-primary" role="status">
			<span class="visually-hidden">Loading...</span>
		</div>
	</div>

	<script src="js/bootstrap.bundle.min.js"></script>
	<script src="js/tiny-slider.js"></script>
	<script src="js/flatpickr.min.js"></script>
	<script src="js/aos.js"></script>
	<script src="js/glightbox.min.js"></script>
	<script src="js/navbar.js"></script>
	<script src="js/counter.js"></script>
	<script src="js/custom.js"></script>


	<script>
		async function fetchBlogData() {
			try {
				const response = await fetch('http://localhost:5000/blog/getdata');
				const data = await response.json();
				console.log(data.data);
				return data.data;
			} catch (error) {
				console.error('Error fetching blog data:', error);
			}
		}

		async function fetchAndRenderPosts(pageNumber, postsPerPage) {
			const blogData = await fetchBlogData();
			renderBlogPosts(blogData, pageNumber, postsPerPage);
		}

		function renderBlogPosts(posts, currentPage = 1, postsPerPage = 9) {
			const blogsContainer = document.getElementById('blogsContainer');
			const startIndex = (currentPage - 1) * postsPerPage;
			const endIndex = startIndex + postsPerPage;
			const paginatedPosts = posts.slice(startIndex, endIndex);

			function formatDate(timestamp) {
				const options = { year: 'numeric', month: 'long', day: 'numeric' };
				const date = new Date(timestamp);
				return date.toLocaleDateString('en-US', options);
			}


			function truncateContent(content, wordLimit) {
				const words = content.split(' ');
				if (words.length > wordLimit) {
					return words.slice(0, wordLimit).join(' ') + '...';
				} else {
					return content;
				}
			}

			if (Array.isArray(paginatedPosts)) {
				blogsContainer.innerHTML = ''; // Clear existing content

				paginatedPosts.forEach(post => {

					const baseUrl = 'http://localhost:5000';
					const imageUrl = `${baseUrl}/${post.image}`;
					const formattedDate = formatDate(post.post_time);

					const truncatedContent = truncateContent(post.content, 50);

					const postHtml = `
						<div class="col-lg-4 mb-4">
							<div class="post-entry-alt">
								<a href="#" class="img-link" onclick="showSingleBlog('${post._id}')">
                            <img src="${imageUrl}" alt="Image" class="img-fluid" />
                        </a>
								<div class="excerpt">
									<h2><a onclick="showSingleBlog('${post._id}')">${post.title}</a></h2>
									<div class="post-meta align-items-center text-left clearfix">
										<figure class="author-figure mb-0 me-3 float-start">
											<img src="images/author-image-malik.png" alt="Image" class="img-fluid" />
										</figure>
										<span class="d-inline-block mt-1">By <a href="#">${post.author}</a></span>
										<span>&nbsp;-&nbsp; ${formattedDate}</span>
									</div>
									<p>${truncatedContent}</p>
									<p><a onclick="showSingleBlog('${post._id}')" class="read-more">Continue Reading</a></p>
								</div>
							</div>
						</div>
					`;

					blogsContainer.insertAdjacentHTML('beforeend', postHtml);
				});

				renderPagination(posts.length, currentPage, postsPerPage);
			} else {
				console.error('Invalid data format: posts is not an array');
			}
		}

		function renderPagination(totalPosts, currentPage, postsPerPage) {
			const totalPages = Math.ceil(totalPosts / postsPerPage);
			const paginationContainer = document.getElementById('paginationContainer');

			let paginationHtml = '<ul class="pagination">';
			for (let i = 1; i <= totalPages; i++) {
				const activeClass = i === currentPage ? 'active' : '';
				paginationHtml += `<li class="page-item ${activeClass}"><a class="page-link" href="#" onclick="changePage(${i}, ${postsPerPage})">${i}</a></li>`;
			}
			paginationHtml += '</ul>';

			paginationContainer.innerHTML = paginationHtml;
		}

		function changePage(pageNumber, postsPerPage) {
			fetchAndRenderPosts(pageNumber, postsPerPage);
		}

		function showSingleBlog(postLink) {
			// Navigate to the single blog page with the selected postLink
			window.location.href = `single-blog.html?postLink=${postLink}`;
		}

		// Fetch blog data and render posts on page load
		document.addEventListener('DOMContentLoaded', async () => {
			const postsPerPage = 9;
			fetchAndRenderPosts(1, postsPerPage);
		});

	</script>
</body>

</html>